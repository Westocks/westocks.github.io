<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WESTOCKS Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;height:100%;overflow:hidden;
  font-family:Arial,sans-serif;color:white
}
body{
  background:linear-gradient(270deg,#0f2027,#203a43,#2c5364);
  background-size:600% 600%;
  animation:bgMove 18s ease infinite;
}
@keyframes bgMove{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

#stars{
  position:fixed;inset:0;z-index:0
}

.app{
  position:relative;z-index:1;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center
}

.panel{
  background:rgba(0,0,0,.45);
  border-radius:16px;
  padding:26px;
  width:1000px;
  max-height:92%;
  overflow:auto;
  box-shadow:0 0 40px rgba(0,0,0,.6)
}

h1{text-align:center;letter-spacing:4px;margin:0}
.small{opacity:.8;font-size:13px}

button,input{
  padding:7px 12px;
  border-radius:8px;
  border:none;
  font-weight:bold
}
button{cursor:pointer}
.trade{background:white;color:black}
.toggle{background:rgba(255,255,255,.2);color:white}

.stock{
  background:rgba(255,255,255,.08);
  border-radius:12px;
  padding:14px;
  margin-top:14px
}

.stock-header{
  display:flex;
  justify-content:space-between;
  align-items:center
}

canvas.graph{
  width:100%;
  height:140px;
  background:rgba(0,0,0,.25);
  border-radius:8px;
  margin-top:10px;
  display:none
}
</style>
</head>

<body>
<canvas id="stars"></canvas>

<div class="app">
  <div class="panel">

    <h1>WESTOCKS</h1>

    <!-- START SCREEN -->
    <div id="start">
      <p class="small" style="text-align:center">
        Demo only â€” NOT real money
      </p>
      <div style="text-align:center;margin-top:20px">
        <button class="trade" onclick="startDemo()">
          Start Investing (Demo)
        </button>
      </div>
    </div>

    <!-- MARKET -->
    <div id="market" style="display:none">
      <div class="small">
        Cash: $<span id="cash">1000.00</span> |
        Active players: <span id="players">1</span>
      </div>

      <div style="margin:12px 0">
        <button class="toggle" onclick="toggleAllGraphs()">Toggle All Graphs</button>
      </div>

      <div id="stocks"></div>
    </div>

  </div>
</div>

<script>
/* ========= STAR BACKGROUND ========= */
const sc=document.getElementById("stars");
const ctx=sc.getContext("2d");
function resize(){sc.width=innerWidth;sc.height=innerHeight}
resize();addEventListener("resize",resize);

const stars=[...Array(180)].map(()=>({
  x:Math.random()*sc.width,
  y:Math.random()*sc.height,
  r:Math.random()*1.5+.3,
  v:Math.random()*.4+.1
}));

(function animate(){
  ctx.clearRect(0,0,sc.width,sc.height);
  stars.forEach(s=>{
    s.y+=s.v;if(s.y>sc.height)s.y=0;
    ctx.globalAlpha=Math.random();
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fillStyle="white";
    ctx.fill();
  });
  requestAnimationFrame(animate);
})();

/* ========= DATA ========= */
let cash=1000;
let showGraphs=false;

const stocks={
  NOVA:{name:"Nova Dynamics",price:120,shares:0,history:[120]},
  ORBX:{name:"Orbex Labs",price:75,shares:0,history:[75]},
  ZENT:{name:"Zenith Core",price:200,shares:0,history:[200]}
};

/* ========= FAKE PLAYER COUNT ========= */
let players=1+Math.floor(Math.random()*30);
setInterval(()=>{
  players+=Math.floor(Math.random()*3)-1;
  if(players<1)players=1;
  document.getElementById("players").innerText=players;
},3000);

/* ========= START ========= */
function startDemo(){
  document.getElementById("start").style.display="none";
  document.getElementById("market").style.display="block";
  render();
}

/* ========= MARKET MOVEMENT ========= */
setInterval(()=>{
  for(const s in stocks){
    const st=stocks[s];
    const change=(Math.random()-.5)*0.07;
    st.price=Math.max(5,+(st.price*(1+change)).toFixed(2));
    st.history.push(st.price);
    if(st.history.length>80)st.history.shift();
  }
  render();
},3000);

/* ========= BUY / SELL (ON SCREEN) ========= */
function buy(sym){
  const input=document.getElementById("buy-"+sym);
  const usd=parseFloat(input.value);
  if(isNaN(usd)||usd<=0)return;
  const st=stocks[sym];
  cash-=usd; // negatives allowed
  st.shares+=usd/st.price;
  input.value="";
  render();
}

function sell(sym){
  const input=document.getElementById("sell-"+sym);
  const qty=parseFloat(input.value);
  if(isNaN(qty)||qty<=0)return;
  const st=stocks[sym];
  if(qty>st.shares)return;
  st.shares-=qty;
  cash+=qty*st.price;
  input.value="";
  render();
}

/* ========= GRAPHS ========= */
function toggleAllGraphs(){
  showGraphs=!showGraphs;
  document.querySelectorAll(".graph").forEach(c=>{
    c.style.display=showGraphs?"block":"none";
  });
  if(showGraphs) drawAllGraphs();
}

function drawAllGraphs(){
  for(const s in stocks) drawGraph(s);
}

function drawGraph(sym){
  const c=document.getElementById("g-"+sym);
  if(!c)return;
  const g=c.getContext("2d");
  const d=stocks[sym].history;
  g.clearRect(0,0,c.width,c.height);
  if(d.length<2)return;
  const min=Math.min(...d),max=Math.max(...d);
  g.strokeStyle="white";
  g.beginPath();
  d.forEach((p,i)=>{
    const x=i/(d.length-1)*c.width;
    const y=c.height-(p-min)/(max-min+0.01)*c.height;
    i?g.lineTo(x,y):g.moveTo(x,y);
  });
  g.stroke();
}

/* ========= RENDER ========= */
function render(){
  document.getElementById("cash").innerText=cash.toFixed(2);
  const wrap=document.getElementById("stocks");
  wrap.innerHTML="";
  for(const s in stocks){
    const st=stocks[s];
    wrap.innerHTML+=`
      <div class="stock">
        <div class="stock-header">
          <div>
            <strong>${s}</strong>
            <div class="small">${st.name}</div>
            <div class="small">Owned: ${st.shares.toFixed(3)}</div>
          </div>
          <div style="text-align:right">
            <div><strong>$${st.price}</strong></div>
          </div>
        </div>

        <div style="margin-top:8px">
          <input id="buy-${s}" type="number" placeholder="USD to buy">
          <button class="trade" onclick="buy('${s}')">Buy</button>
        </div>

        <div style="margin-top:6px">
          <input id="sell-${s}" type="number" placeholder="Shares to sell">
          <button class="trade" onclick="sell('${s}')">Sell</button>
        </div>

        <canvas class="graph" id="g-${s}" width="900" height="140"></canvas>
      </div>
    `;
    if(showGraphs) drawGraph(s);
  }
}
</script>
</body>
</html>
