<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WESTOCKS Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;height:100%;overflow:hidden;
  font-family:Arial,sans-serif;color:white
}
body{
  background:linear-gradient(270deg,#0f2027,#203a43,#2c5364);
  background-size:600% 600%;
  animation:bgMove 18s ease infinite;
}
@keyframes bgMove{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

canvas#stars{position:fixed;inset:0;z-index:0}

.app{
  position:relative;z-index:1;
  height:100%;display:flex;
  justify-content:center;align-items:center
}

.panel{
  background:rgba(0,0,0,.45);
  border-radius:16px;
  padding:24px;
  width:1000px;
  max-height:92%;
  overflow:auto;
  box-shadow:0 0 40px rgba(0,0,0,.6)
}

h1{text-align:center;letter-spacing:4px;margin-top:0}
.small{opacity:.8;font-size:13px}

button{
  padding:8px 14px;
  border:none;border-radius:8px;
  font-weight:bold;cursor:pointer
}
.trade{background:white;color:black}
.toggle{background:rgba(255,255,255,.18);color:white}

.stock{
  background:rgba(255,255,255,.08);
  border-radius:12px;
  padding:14px;margin-top:14px
}
.stock-header{
  display:flex;justify-content:space-between;align-items:center
}
.stock-price{font-weight:800}

canvas.graph{
  width:100%;height:120px;
  margin-top:10px;
  display:none;
  background:rgba(0,0,0,.25);
  border-radius:8px
}

/* TRADE PANEL */
#tradePanel{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10
}
.trade-box{
  background:#0f172a;
  padding:20px;
  border-radius:14px;
  width:300px;
  text-align:center
}
.trade-box input{
  width:100%;
  padding:8px;
  margin-top:10px;
  border-radius:8px;
  border:none
}
</style>
</head>

<body>
<canvas id="stars"></canvas>

<div class="app">
  <div class="panel">

    <h1>WESTOCKS</h1>
    <div class="small" style="text-align:center">
      Demo only — NOT real money • Active players: <span id="players"></span>
    </div>

    <div class="small" style="margin-top:10px">
      Cash: $<span id="cash">1000.00</span>
    </div>

    <div style="margin:12px 0">
      <button class="toggle" onclick="toggleAllGraphs()">Toggle All Graphs</button>
    </div>

    <div id="stocks"></div>

  </div>
</div>

<!-- TRADE PANEL -->
<div id="tradePanel">
  <div class="trade-box">
    <h3 id="tradeTitle"></h3>
    <input id="tradeInput" type="number" step="any">
    <div style="margin-top:14px">
      <button class="trade" onclick="confirmTrade()">Confirm</button>
      <button class="toggle" onclick="closeTrade()">Cancel</button>
    </div>
  </div>
</div>

<script>
/* ===== STARS ===== */
const sc=document.getElementById("stars"),ctx=sc.getContext("2d");
function resize(){sc.width=innerWidth;sc.height=innerHeight}
resize();addEventListener("resize",resize);
const stars=[...Array(180)].map(()=>({
  x:Math.random()*sc.width,y:Math.random()*sc.height,
  r:Math.random()*1.5+.3,v:Math.random()*.4+.1
}));
(function anim(){
  ctx.clearRect(0,0,sc.width,sc.height);
  stars.forEach(s=>{
    s.y+=s.v;if(s.y>sc.height)s.y=0;
    ctx.globalAlpha=Math.random();
    ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fillStyle="white";ctx.fill();
  });
  requestAnimationFrame(anim);
})();

/* ===== DATA ===== */
let cash=1000;
let allGraphs=false;
let tradeMode=null,tradeStock=null;

const stocks={
  NOVA:{name:"Nova Dynamics",price:120,shares:0,history:[120]},
  ORBX:{name:"Orbex Labs",price:75,shares:0,history:[75]},
  ZENT:{name:"Zenith Core",price:200,shares:0,history:[200]}
};

/* ===== ACTIVE PLAYERS (FAKE) ===== */
const base=Math.floor(Math.random()*200)+50;
document.getElementById("players").innerText=base;

/* ===== PRICES ===== */
setInterval(()=>{
  for(const s in stocks){
    const st=stocks[s];
    const ch=(Math.random()-.5)*0.08;
    st.price=Math.max(5,+(st.price*(1+ch)).toFixed(2));
    st.history.push(st.price);
    if(st.history.length>80)st.history.shift();
  }
  render();
},3000);

/* ===== TRADE UI ===== */
function openTrade(sym,mode){
  tradeStock=sym;
  tradeMode=mode;
  document.getElementById("tradePanel").style.display="flex";
  document.getElementById("tradeTitle").innerText=
    mode==="buy" ? "Buy with USD" : "Sell shares";
  document.getElementById("tradeInput").value="";
}
function closeTrade(){
  document.getElementById("tradePanel").style.display="none";
}
function confirmTrade(){
  const val=parseFloat(document.getElementById("tradeInput").value);
  if(isNaN(val)||val<=0)return;
  const st=stocks[tradeStock];
  if(tradeMode==="buy"){
    cash-=val;
    st.shares+=val/st.price;
  }else{
    if(val>st.shares)return;
    st.shares-=val;
    cash+=val*st.price;
  }
  closeTrade();
  render();
}

/* ===== GRAPHS ===== */
function toggleAllGraphs(){
  allGraphs=!allGraphs;
  document.querySelectorAll(".graph").forEach(c=>{
    c.style.display=allGraphs?"block":"none";
  });
}
function drawGraph(sym){
  const c=document.getElementById("g-"+sym),g=c.getContext("2d");
  const d=stocks[sym].history;
  g.clearRect(0,0,c.width,c.height);
  if(d.length<2)return;
  const min=Math.min(...d),max=Math.max(...d);
  g.strokeStyle="white";g.beginPath();
  d.forEach((p,i)=>{
    const x=i/(d.length-1)*c.width;
    const y=c.height-(p-min)/(max-min+.01)*c.height;
    i?g.lineTo(x,y):g.moveTo(x,y);
  });
  g.stroke();
}

/* ===== RENDER ===== */
function render(){
  document.getElementById("cash").innerText=cash.toFixed(2);
  const wrap=document.getElementById("stocks");
  wrap.innerHTML="";
  for(const s in stocks){
    const st=stocks[s];
    wrap.innerHTML+=`
      <div class="stock">
        <div class="stock-header">
          <div>
            <strong>${s}</strong>
            <div class="small">${st.name}</div>
            <div class="small">Owned: ${st.shares.toFixed(3)}</div>
          </div>
          <div style="text-align:right">
            <div class="stock-price">$${st.price}</div>
            <button class="trade" onclick="openTrade('${s}','buy')">Buy</button>
            <button class="trade" onclick="openTrade('${s}','sell')">Sell</button>
          </div>
        </div>
        <canvas class="graph" id="g-${s}" width="800" height="120"></canvas>
      </div>
    `;
    drawGraph(s);
  }
}
render();
</script>

</body>
</html>
