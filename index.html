<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WESTOCKS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
html,body{
  margin:0;height:100%;
  font-family:Arial;color:white
}
body{
  display:flex;justify-content:center;align-items:center;
  background:linear-gradient(270deg,#0f2027,#203a43,#2c5364);
  background-size:600% 600%;
  animation:bg 18s ease infinite
}
@keyframes bg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
.container{
  max-width:1000px;width:100%;
  background:rgba(0,0,0,.45);
  padding:20px;border-radius:16px
}
h1{text-align:center;letter-spacing:4px}
button{
  padding:8px 14px;border:none;
  border-radius:6px;font-weight:bold;
  cursor:pointer
}
.buy{background:white;color:black}
.sell{background:#ffb3b3;color:black}
.stock{
  margin-top:16px;padding:14px;
  background:rgba(255,255,255,.08);
  border-radius:12px
}
input{width:80px;padding:4px;border-radius:4px;border:none}
#active{text-align:center;margin-bottom:10px}
.me{color:cyan;font-weight:bold}
</style>
</head>

<body>
<div class="container">

<h1>WESTOCKS</h1>
<div id="active">Active Players: 0</div>

<div id="start">
  <p style="text-align:center">Demo only ‚Äî not real money</p>
  <div style="text-align:center">
    <button id="startBtn" class="buy">Start Investing</button>
  </div>
</div>

<div id="game" style="display:none">
  Cash: $<span id="cash">1000.00</span><br>
  Portfolio: $<span id="total">1000.00</span>

  <div class="stock">
    <strong>üèÜ Leaderboard</strong>
    <ol id="leaderboard"></ol>
  </div>

  <div id="stocks"></div>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

/* üî• FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyDcgWQyY9QewcZ5v1QLC6rRD9AWfqicKgQ",
  authDomain: "westocks-5184b.firebaseapp.com",
  databaseURL: "https://westocks-5184b-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "westocks-5184b",
  storageBucket: "westocks-5184b.firebasestorage.app",
  messagingSenderId: "265102905724",
  appId: "1:265102905724:web:52c5c7365df3929a32d4f9"
});
const db = firebase.database();

/* ELEMENTS */
const startBtn = document.getElementById("startBtn");
const start = document.getElementById("start");
const game = document.getElementById("game");
const cashEl = document.getElementById("cash");
const totalEl = document.getElementById("total");
const stocksEl = document.getElementById("stocks");
const leaderboardEl = document.getElementById("leaderboard");
const activeEl = document.getElementById("active");

/* USERNAME */
let username = localStorage.getItem("username");
if(!username){
  username = prompt("Choose a username") || "Guest"+Math.floor(Math.random()*1000);
  localStorage.setItem("username", username);
}

/* FIREBASE REFS */
const playerId = Math.random().toString(36).slice(2);
const activeRef = db.ref("activePlayers");
const leaderRef = db.ref("leaderboard");

/* ACTIVE PLAYER */
activeRef.child(playerId).set(true);
window.addEventListener("beforeunload",()=>{
  activeRef.child(playerId).remove();
  leaderRef.child(playerId).remove();
});
activeRef.on("value",s=>{
  activeEl.innerText="Active Players: "+s.numChildren();
});

/* GAME DATA */
let cash = 1000;
const stocks = {
  NOVA:{price:120,shares:0},
  ORBX:{price:80,shares:0},
  ZENT:{price:200,shares:0}
};

/* START BUTTON */
startBtn.onclick = () => {
  start.style.display="none";
  game.style.display="block";
  render();
};

/* PRICE UPDATE */
setInterval(()=>{
  for(const s in stocks){
    stocks[s].price = +(stocks[s].price*(1+(Math.random()-0.5)*0.05)).toFixed(2);
  }
  render();
},2500);

/* BUY / SELL */
function buy(sym){
  let amt = +document.getElementById("buy-"+sym).value;
  if(!amt || amt>cash) return;
  let st = stocks[sym];
  let shares = amt/st.price;
  cash -= amt;
  st.shares += shares;
  render();
}
function sell(sym){
  let qty = +document.getElementById("sell-"+sym).value;
  let st = stocks[sym];
  if(!qty || qty>st.shares) return;
  st.shares -= qty;
  cash += qty*st.price;
  render();
}

/* RENDER */
function render(){
  cashEl.innerText = cash.toFixed(2);
  let total = cash;
  for(const s in stocks) total += stocks[s].shares*stocks[s].price;
  totalEl.innerText = total.toFixed(2);

  leaderRef.child(playerId).set({name:username,value:total});

  stocksEl.innerHTML = Object.keys(stocks).map(s=>{
    let st=stocks[s];
    return `
    <div class="stock">
      <b>${s}</b> ‚Äî $${st.price}<br>
      Shares: ${st.shares.toFixed(3)}<br><br>
      Buy $ <input id="buy-${s}" type="number">
      <button class="buy" onclick="buy('${s}')">Buy</button>
      Sell <input id="sell-${s}" type="number" step="0.01">
      <button class="sell" onclick="sell('${s}')">Sell</button>
    </div>`;
  }).join("");
}

/* LEADERBOARD */
leaderRef.on("value",snap=>{
  let arr=[];
  snap.forEach(c=>arr.push(c.val()));
  arr.sort((a,b)=>b.value-a.value);
  leaderboardEl.innerHTML = arr.slice(0,10).map(p=>
    `<li class="${p.name===username?'me':''}">
      ${p.name}: $${p.value.toFixed(2)}
    </li>`
  ).join("");
});

});
</script>
</body>
</html>
