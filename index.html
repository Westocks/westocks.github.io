<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WESTOCKS Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;height:100%;overflow:hidden;
  font-family:Arial,sans-serif;color:white
}
body{
  background:linear-gradient(270deg,#0f2027,#203a43,#2c5364);
  background-size:600% 600%;
  animation:bgMove 18s ease infinite;
}
@keyframes bgMove{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

canvas#stars{position:fixed;inset:0;z-index:0}

.app{
  position:relative;z-index:1;
  height:100%;
  display:flex;justify-content:center;align-items:center
}

.panel{
  background:rgba(0,0,0,.45);
  border-radius:16px;
  padding:24px;
  width:1000px;
  max-height:94%;
  overflow:auto;
}

h1{text-align:center;letter-spacing:4px;margin:0}

button{
  padding:8px 14px;border:none;border-radius:8px;
  font-weight:bold;cursor:pointer
}
.trade{background:white;color:black}
.toggle{background:rgba(255,255,255,.2);color:white}

.stock{
  background:rgba(255,255,255,.08);
  border-radius:12px;padding:14px;margin-top:14px
}

canvas.graph{
  display:none;
  width:100%;
  height:140px;
  margin-top:10px;
  background:rgba(0,0,0,.3);
  border-radius:8px
}

.msg{
  margin-top:10px;
  font-size:14px;
  opacity:.9
}
</style>
</head>

<body>
<canvas id="stars"></canvas>

<div class="app">
<div class="panel">

<h1>WESTOCKS</h1>

<div id="start">
  <p style="text-align:center">Demo only — NOT real money</p>
  <div style="text-align:center">
    <button class="trade" onclick="start()">Start Investing</button>
  </div>
</div>

<div id="market" style="display:none">
  <p>Cash: $<span id="cash">1000</span></p>
  <p>Active players: <span id="players">1</span></p>
  <div id="message" class="msg"></div>
  <div id="stocks"></div>
</div>

</div>
</div>

<script>
/* ===== BACKGROUND STARS ===== */
const sc=document.getElementById("stars"),ctx=sc.getContext("2d");
function resize(){sc.width=innerWidth;sc.height=innerHeight}
resize();addEventListener("resize",resize);
const stars=[...Array(150)].map(()=>({
  x:Math.random()*sc.width,y:Math.random()*sc.height,
  r:Math.random()*1.5+.5,v:Math.random()*.4+.1
}));
(function anim(){
  ctx.clearRect(0,0,sc.width,sc.height);
  stars.forEach(s=>{
    s.y+=s.v;if(s.y>sc.height)s.y=0;
    ctx.globalAlpha=Math.random();
    ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,6.28);
    ctx.fillStyle="white";ctx.fill();
  });
  requestAnimationFrame(anim);
})();

/* ===== DATA ===== */
let cash=1000;
const stocks={
  NOVA:{price:120,shares:0,history:[],buyLine:null,graph:true},
  ORBX:{price:80,shares:0,history:[],buyLine:null,graph:true},
  ZENT:{price:200,shares:0,history:[],buyLine:null,graph:true}
};

/* ===== START ===== */
function start(){
  document.getElementById("start").style.display="none";
  document.getElementById("market").style.display="block";
  renderStocks();
}

/* ===== PLAYER COUNT (FAKE) ===== */
setInterval(()=>{
  document.getElementById("players").innerText=
    Math.floor(20+Math.random()*30);
},4000);

/* ===== PRICE UPDATE ===== */
setInterval(()=>{
  for(const s in stocks){
    const st=stocks[s];
    st.price=Math.max(5,+(st.price*(1+(Math.random()-.5)*0.06)).toFixed(2));
    st.history.push(st.price);
    if(st.history.length>100)st.history.shift();
    drawGraph(s);
  }
},2000);

/* ===== BUY / SELL ===== */
function buy(sym){
  const amt=100;
  const st=stocks[sym];
  const qty=amt/st.price;
  cash-=amt;
  st.shares+=qty;
  st.buyLine=st.price;
  document.getElementById("message").innerText=
    `Bought ${qty.toFixed(2)} shares of ${sym}`;
  updateCash();
}

function sell(sym){
  const st=stocks[sym];
  if(st.shares<=0)return;
  const qty=st.shares/2;
  st.shares-=qty;
  cash+=qty*st.price;
  document.getElementById("message").innerText=
    `Sold ${qty.toFixed(2)} shares of ${sym}`;
  updateCash();
}

function updateCash(){
  document.getElementById("cash").innerText=cash.toFixed(2);
}

/* ===== GRAPHS ===== */
function toggleGraph(sym){
  const c=document.getElementById("g-"+sym);
  stocks[sym].graph=!stocks[sym].graph;
  c.style.display=stocks[sym].graph?"block":"none";
  drawGraph(sym);
}

function drawGraph(sym){
  const c=document.getElementById("g-"+sym);
  if(!stocks[sym].graph)return;
  const ctx=c.getContext("2d");
  c.width=c.offsetWidth;
  c.height=c.offsetHeight;
  const d=stocks[sym].history;
  if(d.length<2)return;

  const min=Math.min(...d),max=Math.max(...d);
  ctx.clearRect(0,0,c.width,c.height);

  ctx.strokeStyle="white";
  ctx.beginPath();
  d.forEach((p,i)=>{
    const x=i/(d.length-1)*c.width;
    const y=c.height-(p-min)/(max-min+.01)*c.height;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  ctx.stroke();

  if(stocks[sym].buyLine){
    const y=c.height-(stocks[sym].buyLine-min)/(max-min+.01)*c.height;
    ctx.strokeStyle="lime";
    ctx.beginPath();
    ctx.moveTo(0,y);ctx.lineTo(c.width,y);
    ctx.stroke();
  }
}

/* ===== UI ===== */
function renderStocks(){
  const wrap=document.getElementById("stocks");
  for(const s in stocks){
    const div=document.createElement("div");
    div.className="stock";
    div.innerHTML=`
      <b>${s}</b> — $${stocks[s].price}<br>
      Shares: ${stocks[s].shares.toFixed(2)}<br>
      <button class="trade" onclick="buy('${s}')">Buy</button>
      <button class="trade" onclick="sell('${s}')">Sell</button>
      <button class="toggle" onclick="toggleGraph('${s}')">Graph</button>
      <canvas class="graph" id="g-${s}"></canvas>
    `;
    wrap.appendChild(div);
  }
}
</script>

</body>
</html>
