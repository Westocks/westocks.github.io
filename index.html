<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WESTOCKS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;height:100%;overflow:hidden;
  font-family:Arial,sans-serif;color:white
}
body{
  background:linear-gradient(270deg,#0f2027,#203a43,#2c5364);
  background-size:600% 600%;
  animation:bgMove 18s ease infinite;
}
@keyframes bgMove{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

#stars{
  position:fixed;inset:0;z-index:0
}

.app{
  position:relative;z-index:1;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center
}

.panel{
  width:1000px;
  max-height:92%;
  overflow:auto;
  padding:24px;
  border-radius:16px;
  background:rgba(0,0,0,.45);
  box-shadow:0 0 40px rgba(0,0,0,.6)
}

h1{text-align:center;letter-spacing:4px;margin:0}
.small{opacity:.8;font-size:13px}

button,input{
  padding:8px 12px;
  border-radius:8px;
  border:none;
  font-weight:bold
}
button{cursor:pointer}
.trade{background:white;color:black}
.toggle{background:rgba(255,255,255,.2);color:white}

.stock{
  margin-top:16px;
  padding:14px;
  border-radius:12px;
  background:rgba(255,255,255,.08)
}
.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px
}

.graph{
  margin-top:10px;
  background:rgba(0,0,0,.25);
  border-radius:8px;
}
</style>
</head>

<body>
<canvas id="stars"></canvas>

<div class="app">
<div class="panel">

<h1>WESTOCKS</h1>

<div id="start">
  <p class="small" style="text-align:center">
    Demo only — NOT real money
  </p>
  <div style="text-align:center;margin:20px">
    <button onclick="startDemo()">Start Investing (Demo)</button>
  </div>
</div>

<div id="market" style="display:none">

<div class="small">
  Cash: $<span id="cash">0</span> |
  Active players: <span id="players">0</span>
</div>

<div id="stocks"></div>

</div>

</div>
</div>

<script>
/* ===== STAR BACKGROUND ===== */
const starCanvas=document.getElementById("stars");
const sctx=starCanvas.getContext("2d");
function resizeStars(){
  starCanvas.width=innerWidth;
  starCanvas.height=innerHeight;
}
resizeStars();addEventListener("resize",resizeStars);

const stars=[...Array(180)].map(()=>({
  x:Math.random()*starCanvas.width,
  y:Math.random()*starCanvas.height,
  r:Math.random()*1.5+.3,
  v:Math.random()*.4+.1
}));

(function animStars(){
  sctx.clearRect(0,0,starCanvas.width,starCanvas.height);
  stars.forEach(s=>{
    s.y+=s.v;
    if(s.y>starCanvas.height)s.y=0;
    sctx.globalAlpha=Math.random();
    sctx.beginPath();
    sctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    sctx.fillStyle="white";
    sctx.fill();
  });
  requestAnimationFrame(animStars);
})();

/* ===== DATA ===== */
let cash=1000;
const graphOpen={};
const stocks={
  NOVA:{name:"Nova Dynamics",price:120,shares:0,history:[120]},
  ORBX:{name:"Orbex Labs",price:75,shares:0,history:[75]},
  ZENT:{name:"Zenith Core",price:200,shares:0,history:[200]}
};

/* ===== FAKE PLAYER COUNT ===== */
document.getElementById("players").innerText =
  Math.floor(50+Math.random()*200);

/* ===== START ===== */
function startDemo(){
  document.getElementById("start").style.display="none";
  document.getElementById("market").style.display="block";
  render();
}

/* ===== MARKET ===== */
setInterval(()=>{
  for(const s in stocks){
    const st=stocks[s];
    const change=(Math.random()-.5)*0.08;
    st.price=Math.max(5,+(st.price*(1+change)).toFixed(2));
    st.history.push(st.price);
    if(st.history.length>60)st.history.shift();
    if(graphOpen[s]) drawGraph(s);
  }
  document.getElementById("cash").innerText=cash.toFixed(2);
},3000);

/* ===== BUY / SELL (ON SCREEN) ===== */
function buy(sym){
  const input=document.getElementById("buy-"+sym);
  const usd=parseFloat(input.value);
  if(isNaN(usd)||usd<=0)return;
  const st=stocks[sym];
  const shares=usd/st.price;
  cash-=usd;
  st.shares+=shares;
  input.value="";
  render();
}

function sell(sym){
  const input=document.getElementById("sell-"+sym);
  const qty=parseFloat(input.value);
  if(isNaN(qty)||qty<=0)return;
  const st=stocks[sym];
  if(qty>st.shares)return;
  st.shares-=qty;
  cash+=qty*st.price;
  input.value="";
  render();
}

/* ===== GRAPH ===== */
function toggleGraph(sym){
  graphOpen[sym]=!graphOpen[sym];
  document.getElementById("graph-"+sym).style.display=
    graphOpen[sym]?"block":"none";
  if(graphOpen[sym]) drawGraph(sym);
}

function drawGraph(sym){
  const c=document.getElementById("canvas-"+sym);
  const ctx=c.getContext("2d");
  const data=stocks[sym].history;
  ctx.clearRect(0,0,c.width,c.height);
  const min=Math.min(...data),max=Math.max(...data);
  ctx.strokeStyle="white";
  ctx.beginPath();
  data.forEach((p,i)=>{
    const x=i/(data.length-1)*c.width;
    const y=c.height-(p-min)/(max-min+0.01)*c.height;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  ctx.stroke();
}

/* ===== RENDER ===== */
function render(){
  document.getElementById("cash").innerText=cash.toFixed(2);
  const wrap=document.getElementById("stocks");
  wrap.innerHTML="";
  for(const s in stocks){
    const st=stocks[s];
    wrap.innerHTML+=`
    <div class="stock">
      <div class="row">
        <div>
          <strong>${s}</strong> – $${st.price}<br>
          <span class="small">Owned: ${st.shares.toFixed(3)}</span>
        </div>
        <div>
          <input id="buy-${s}" placeholder="$ buy" size="6">
          <button class="trade" onclick="buy('${s}')">Buy</button><br>
          <input id="sell-${s}" placeholder="shares" size="6">
          <button class="trade" onclick="sell('${s}')">Sell</button><br>
          <button class="toggle" onclick="toggleGraph('${s}')">Graph</button>
        </div>
      </div>
      <div id="graph-${s}" class="graph" style="display:${graphOpen[s]?"block":"none"}">
        <canvas id="canvas-${s}" width="900" height="140"></canvas>
      </div>
    </div>`;
    if(graphOpen[s]) drawGraph(s);
  }
}
</script>

</body>
</html>
